#!/usr/bin/env ruby

require 'rubygems'
require 'pxlsrt'
require 'thor'

##
# The command line. Created using Thor. Universal options:
# * reverse - Reverses the bands or randomly reverses or doesn't reverse.
# * vertical - Sorts vertically.
# * diagonal - Sorts diagonally. Use with vertical to change the diagonals' orientation.
# * smooth - "Smoothes" sorted values by grouping identical pixels together.
# * method - What method to use to sort pixels.
# * verbose - Have pxlsrt tell you what it's working on.
# * help - More in depth commands.
class CLI < Thor
	class_option :reverse, :type => :string, :default => "no", :banner => "[no | reverse | either]", :aliases => "-r", :enum => ["no", "reverse", "either"]
	class_option :vertical, :type => :boolean, :default => false, :aliases => "-v"
	class_option :diagonal, :type => :boolean, :default => false, :aliases => "-d"
	class_option :smooth, :type => :boolean, :default => false, :aliases => "-s"
	class_option :method, :type => :string, :default => "sum-rgb", :banner => "[sum-rgb | red | green | blue | sum-hsb | hue | saturation | brightness | uniqueness | luma | random | cyan | magenta | yellow | alpha | sum-rgba | sum-hsba]", :aliases => "-m", :enum => ["sum-rgb", "red", "green", "blue", "sum-hsb", "hue", "saturation", "brightness", "uniqueness", "luma", "random", "cyan", "magenta", "yellow", "alpha", "sum-rgba", "sum-hsba"]
	class_option :verbose, :type => :boolean, :default => false, :aliases => "-V"
	class_option :middle, :default => false, :aliases => "-M"

	option :min, :type => :numeric, :default => Float::INFINITY, :banner => "MINIMUM BANDWIDTH"
	option :max, :type => :numeric, :default => Float::INFINITY, :banner => "MAXIMUM BANDWIDTH"
	desc "brute INPUT OUTPUT [options]", "Brute pixel sorting"
	##
	# Specific options:
	# * min - Minimum bandwidth.
	# * max - Maximum bandwidth.
	def brute(input, output)
		k={:trusted=>true}
		for o in options.keys
			k[o.to_sym]=options[o]
		end
		Pxlsrt::Brute.suite(input, output, k)
	end

	option :absolute, :type => :boolean, :default => false, :aliases => "-a", :banner => "ABSOLUTE EDGE FINDING"
	option :threshold, :type => :numeric, :default => 20, :aliases => "-t"
	desc "smart INPUT OUTPUT [options]", "Smart pixel sorting"
	##
	# Specific options:
	# * threshold - Number used in edge finding. Specifics explained under "absolute".
	# * absolute - Make edge finding absolute over relative. For example, define a range as a collection of values under the threshold. Relative edge finding is when the contrast of the next pixel is larger than the threshold.
	def smart(input, output)
		k={:trusted=>true}
		for o in options.keys
			k[o.to_sym]=options[o]
		end
		Pxlsrt::Smart.suite(input, output, k)
	end
end

CLI.start(ARGV)